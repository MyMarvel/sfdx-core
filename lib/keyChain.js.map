{"version":3,"file":"keyChain.js","sources":["../src/keyChain.ts"],"sourcesContent":["/*\n * Copyright (c) 2018, salesforce.com, inc.\n * All rights reserved.\n * SPDX-License-Identifier: BSD-3-Clause\n * For full license text, see the LICENSE file in the repo root or https://opensource.org/licenses/BSD-3-Clause\n */\n\nimport { env } from '@salesforce/kit';\nimport { KeyChain, keyChainImpl } from './keyChainImpl';\nimport { Logger } from './logger';\nimport { SfdxError } from './sfdxError';\n\n/**\n * Gets the os level keychain impl.\n * @param platform The os platform.\n * @ignore\n */\nexport const retrieveKeychain = async (platform: string): Promise<KeyChain> => {\n  const logger: Logger = await Logger.child('keyChain');\n  logger.debug(`platform: ${platform}`);\n\n  const useGenericUnixKeychainVar = env.getBoolean('SFDX_USE_GENERIC_UNIX_KEYCHAIN');\n  const shouldUseGenericUnixKeychain = !!useGenericUnixKeychainVar && useGenericUnixKeychainVar;\n\n  if (/^win/.test(platform)) {\n    return keyChainImpl.generic_windows;\n  } else if (/darwin/.test(platform)) {\n    // OSX can use the generic keychain. This is useful when running under an\n    // automation user.\n    if (shouldUseGenericUnixKeychain) {\n      return keyChainImpl.generic_unix;\n    } else {\n      return keyChainImpl.darwin;\n    }\n  } else if (/linux/.test(platform)) {\n    // Use the generic keychain if specified\n    if (shouldUseGenericUnixKeychain) {\n      return keyChainImpl.generic_unix;\n    } else {\n      // otherwise try and use the builtin keychain\n      try {\n        await keyChainImpl.linux.validateProgram();\n        return keyChainImpl.linux;\n      } catch (e) {\n        // If the builtin keychain is not available use generic\n        return keyChainImpl.generic_unix;\n      }\n    }\n  } else {\n    throw SfdxError.create('@salesforce/core', 'encryption', 'UnsupportedOperatingSystemError', [platform]);\n  }\n};\n"],"names":["logger","Logger","env","keyChainImpl","SfdxError"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;AAYA;;;;;MAKa,gBAAgB,GAAG,OAAO,QAAgB;IACrD,MAAMA,QAAM,GAAW,MAAMC,aAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;IACtDD,QAAM,CAAC,KAAK,CAAC,aAAa,QAAQ,EAAE,CAAC,CAAC;IAEtC,MAAM,yBAAyB,GAAGE,aAAG,CAAC,UAAU,CAAC,gCAAgC,CAAC,CAAC;IACnF,MAAM,4BAA4B,GAAG,CAAC,CAAC,yBAAyB,IAAI,yBAAyB,CAAC;IAE9F,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;QACzB,OAAOC,yBAAY,CAAC,eAAe,CAAC;KACrC;SAAM,IAAI,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;;;QAGlC,IAAI,4BAA4B,EAAE;YAChC,OAAOA,yBAAY,CAAC,YAAY,CAAC;SAClC;aAAM;YACL,OAAOA,yBAAY,CAAC,MAAM,CAAC;SAC5B;KACF;SAAM,IAAI,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;;QAEjC,IAAI,4BAA4B,EAAE;YAChC,OAAOA,yBAAY,CAAC,YAAY,CAAC;SAClC;aAAM;;YAEL,IAAI;gBACF,MAAMA,yBAAY,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC;gBAC3C,OAAOA,yBAAY,CAAC,KAAK,CAAC;aAC3B;YAAC,OAAO,CAAC,EAAE;;gBAEV,OAAOA,yBAAY,CAAC,YAAY,CAAC;aAClC;SACF;KACF;SAAM;QACL,MAAMC,mBAAS,CAAC,MAAM,CAAC,kBAAkB,EAAE,YAAY,EAAE,iCAAiC,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC;KACzG;AACH;;;;"}